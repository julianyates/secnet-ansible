---

- name: Testing Registration
  vars:
    servers:
      - name: hqdm.secnetwork.org
      - name: hqdnfdmz.secnetwork.org
      - name: hqdnbdmz.secnetwork.org

  vars_prompt:
    - name: "bind_password"
      prompt: "Password for yatesj-admin"
      private: yes

  tasks:
    - name: Registering '{{ item.name }}'
      hosts: '{{ item.name }}'
      gather_facts: yes
      become: true
      expect:
        command: cmk-update-agent register -v -H '{{ item.name }}' -U yatesj-admin
        responses:
          Password for *: "{{ bind_password }}"
      with_items: '{{ servers }}'
      when: result.stdout == "" 


